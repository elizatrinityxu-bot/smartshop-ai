{% load static %}
<!DOCTYPE html>
<html>
<head>
    <title>SmartShop AI Dashboard</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
</head>
<body class="bg-light">

<nav class="navbar navbar-dark bg-dark">
    <div class="container-fluid">
        <a class="navbar-brand d-flex align-items-center" href="#">
            <!-- Simple inline SVG logo -->
            <svg xmlns="http://www.w3.org/2000/svg" width="28" height="28" fill="currentColor" class="me-2" viewBox="0 0 16 16" aria-hidden="true">
              <path d="M0 1.5A.5.5 0 0 1 .5 1h1a.5.5 0 0 1 .485.379L2.89 5H14.5a.5.5 0 0 1 .49.598l-1.5 6A.5.5 0 0 1 13 12H4a.5.5 0 0 1-.49-.402L1.61 2H.5a.5.5 0 0 1-.5-.5zM4.415 6l1.2 4h7.77l1.2-4H4.415z"/>
              <path d="M6 13.5a1 1 0 1 0 0 2 1 1 0 0 0 0-2zm5 1a1 1 0 1 1-2 0 1 1 0 0 1 2 0z"/>
            </svg>
            <strong>SmartShop AI Dashboard</strong>
        </a>
        <div>
            <span class="text-white">Logged in: {{ user.username }}</span>
            {% if selected_user %}
            <span class="text-white ms-3">Viewing: {{ selected_user.username }}</span>
            {% endif %}
        </div>
    </div>
</nav>

<div class="container mt-4">

    <!-- Page title + subtitle -->
    <h2 class="text-center">Recommended for: {% if selected_user %}{{ selected_user.username }}{% else %}You{% endif %}</h2>
    <p class="text-center text-muted">
        Personalized recommendations powered by AI
    </p>

    <!-- User selector (staff only) -->
    {% if user.is_staff %}
    <form method="get" id="user-select-form" class="mb-3">
        <div class="row justify-content-center">
            <div class="col-md-4">
                <label for="userSelect" class="form-label">Select user:</label>
                <select id="userSelect" name="user_id" class="form-select" onchange="document.getElementById('user-select-form').submit();">
                    {% for u in users %}
                    <option value="{{ u.id }}" {% if selected_user and u.id == selected_user.id %}selected{% endif %}>{{ u.username }}{% if u.email %} - {{ u.email }}{% endif %}</option>
                    {% endfor %}
                </select>
            </div>
        </div>
    </form>
    {% endif %}

    <div class="row">

        <!-- ðŸ”½ THIS IS WHERE THE LOOP STARTS -->
        {% for item in recommendations %}
        <div class="col-md-4 mb-3">
            <div class="card shadow-sm h-100">
                <div class="card-body">

                    <!-- Product name -->
                    <h5 class="card-title">
                        {{ item.product.name }}
                    </h5>

                    <!-- Category -->
                    <p class="text-muted mb-1">
                        {{ item.product.category.name }}
                    </p>

                    <!-- Description -->
                    <p class="card-text">
                        {{ item.product.description }}
                    </p>

                    <!-- Price -->
                    <p class="fw-bold text-success">
                        ${{ item.product.price }}
                    </p>

                    <!-- âœ… AI SCORE GOES HERE -->
                    <span class="badge bg-info">
                        AI Score: {{ item.score }}
                    </span>

                    <!-- âœ… VIEW PRODUCT BUTTON GOES HERE -->
                    <div class="mt-3">
                        <a href="#" class="btn btn-outline-primary btn-sm">
                            View Product
                        </a>
                    </div>

                </div>
            </div>
        </div>
        {% empty %}
        <p>No recommendations available.</p>
        {% endfor %}
        <!-- ðŸ”¼ LOOP ENDS HERE -->

    </div>

</div>

</body>
</html>
